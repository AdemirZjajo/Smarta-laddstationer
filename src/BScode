#include <SPI.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include "communication.hpp"

class DisplayController {
public:
    DisplayController() : display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, RESET) {}

    void initialize() {
        display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
        display.clearDisplay();
        display.setTextColor(WHITE);
        display.setTextSize(0, 1);

        pinMode(buttonAPin, INPUT_PULLUP);
        pinMode(buttonBPin, INPUT_PULLUP);

        randomSeed(analogRead(0));

        setupCommunication();
    }

    void update() {
        loopCommunication();

        display.clearDisplay();

        // Display "Nod 1" at the static x-position
        display.setCursor(35, 20);
        display.printf("Nod: %d", getID());

        display.setCursor(32, 40);
        display.print("Last:");
        display.setCursor(55, 40);
        display.println(weight);

        display.setCursor(32, 30);
        display.print("Battery:");
        display.setCursor(73, 30);
        display.println(battery);

        display.setCursor(32, 50);
        display.print("Lasttyp:");
        display.setCursor(75, 50);
        display.println(loadType);

        display.display();

        delay(100);
    }

private:
    Adafruit_SSD1306 display;
    String weight = "0";
    String battery = "0";
    String loadType = "0";
    const int buttonAPin = 19;
    const int buttonBPin = 18;
    
    const char* batteryOptions[arraySize] = {
        " 10%", " 20%", " 30%", " 40%", " 50%",
        " 60%", " 70%", " 80%", " 90%", " 100%"
    };
    const char* weightOptions[arraySize] = {
        " 1000kg", " 900kg", " 800kg", " 700kg", " 600kg",
        " 500kg", " 400kg", " 300kg", " 200kg", " 100kg"
    };
    const char* loadTypeOptions[arraySize] = {
        " *", "", " *", "", " *",
        "", " *", "", " *", ""
    };
    const int arraySize = 10; // Size of the arrays

    String getRandom(const char* options[], int size) {
        int randomIndex = random(size);
        return options[randomIndex];
    }
};

// Usage in your main sketch
DisplayController displayController;

void setup() {
    displayController.initialize();
}

void loop() {
    displayController.update();
}
